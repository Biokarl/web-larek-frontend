# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка

```
export interface ICard {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | string;
}
```

Состояние приложения

```
export interface IAppState {
	gallery: ICard[];
}
```

Форма заказа

```
export interface IOrderForm {
	email: string;
	phone: string;
	address: string;
}
```

Заказ

```
export interface IOrder extends IOrderForm {
	items: string[];
	total: number;
	payment: 'cash' | 'card' | null;
}
```

Результат выполнения заказа

```
export interface IOrderResult {
	id: string;
}
```

Ошибка формы

```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Об архитектуре

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.

## Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Конструктор принимает такие аргументы: 1. baseUrl: string - базовый URL 2. options: RequestInit - глобальные опции для всех запросов(опционально)

Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - проверяет ответ сервера, при успехе отдает данные, при неудаче показывает ошибку

#### Класс EventEmitter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлятьподписчиков
о наступлении события.

Класс имеет методы on , off , emit — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.

Дополнительно реализованы методы onAll и offAll — для подписки на все события и сброса всех
подписчиков.

Интересным дополнением является метод trigger , генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти
классы будут генерировать события, не будучи при этом напрямую зависимыми от
класса EventEmitter .

#### Класс Component<T>

Класс является дженериком и принимает в переменной T тип данных

Класс реализует методы для работы с DOM в дочерних компонентах

Конструктор принимает такие аргументы:

    1. container: HTMLElement - элемент контейнера, в который будет помещен компонент

Класс имеет такие методы:

    1. toggleClass - Переключить класс
    2. setText - Установить текстовое содержимое
    3. setDisabled - Сменить статус блокировки
    4. setHidden и setVisible - скрыть, либо показать
    5. setImage - Установить изображение с альтернативным текстом
    6. render - Вернуть корневой DOM-элемент

### Слой данных

#### Класс AppState

Находится в основе практически всех частей проекта, является хранилищем для глобального состояния приложения

Класс расширяется от класса дженерика Model<IAppState>

Класс имеет такие методы:

    1. getBasketCard - добавление карточки в корзину
    2. setGallery - изменение галереи
    3. setPreview - изменение превью
    4. getTotal - используется в этом классе для получения цены
    5. addOrderedCard - добавление заказанной карточки
    6. removeOrderedCard - удаление заказанной карточки
    7. setOrderField - изменение значения полей заказа
    8. setContactField - изменение значения полей контактов
    9. clearBasket - очищение корзины
    10. validateOrder - проверка заказа
    11. validateContact - проверка контактов

#### Класс Card

Реализует методы для работы с карточками товаров.

Класс расширяется от класса дженерика Component<ICard>

Конструктор принимает такие аргументы:

    1. blockName: string - для создания имени контейнера
    2. container: HTMLElement - элемент контейнера, в который будет помещен компонент
    3. actions?: ICardActions - действие(например клик)

Класс имеет такие методы:

     toggleButton(state: boolean) - отвечает за возможность использовать  кнопку

Сеттеры и геттеры

    set id(value: string) - изменение id
    get id(): string - получение id
    set title(value: string) - изменение текста в тайтле
    get title(): string - получение текста в тайтле
    set price(value: string) - изменение цены
    get price(): string - получение цены
    set description(value: string) - изменение описания товара

#### Класс Basket

Реализует методы для работы с корзиной товаров.

Класс расширяется от класса дженерика Component<ICard>

Конструктор принимает такие аргументы:

    1. container: HTMLElement - элемент контейнера, в который будет помещен компонент
    2. events: EventEmitter - событие, с которым нужно что-то сделать

Класс имеет такие методы:

     toggleButton(state: boolean) - отвечает за возможность использовать  кнопку

Сеттеры и геттеры

    set items(items: HTMLElement[]) - отображает контент в корзине
    set price(total: number) - отображает цену товаров

#### Класс BasketItem

Реализует создание карточки в корзине

Класс расширяется от класса Card

Конструктор принимает такие аргументы:

    1. container: HTMLElement - элемент контейнера, в который будет помещен компонент
    2. actions?: ICardActions - действие(например клик)

#### Класс CardApi

Реализует методы для работы с запросами для карточек товаров

Класс расширяется от класса Api

Конструктор принимает такие аргументы:

    1. cdn: string - ссылка на массив данных
    2. baseUrl: string - базавая ссылка
    3. options?: RequestInit - дополнительные настройки которые передаются в header запроса

Класс имеет такие методы:

    1. getAllCards - получить все карточки
    2. getCard - получить определенную карточку
    3. orderCards - проданная карточка

#### Класс PreviewCard

Превью карточки при открытом модальном окне

Класс расширяется от класса Card

Конструктор принимает такие аргументы:

    1. container: HTMLElement - элемент контейнера, в который будет помещен компонент
    2. actions?: ICardActions - действие(например клик)

Сеттеры и геттеры

    set category(value: string) - изменение категории товара
    get category(): string - получение категории товара в открытом модальном окне
    set image(value: string) - изменение картинки товара в открытом модальном окне

#### Класс CatalogCard

Отображение карточки на странице

Используется для создания каталога с карточками товаров

Класс расширяется от класса Card

Конструктор принимает такие аргументы:

    1. container: HTMLElement - элемент контейнера, в который будет помещен компонент
    2. actions?: ICardActions - действие(например клик)

Сеттеры и геттеры

    set image(value: string) - изменение картинки товара при отображении страницы
    set category(value: string) - изменение категории товара при отображении страницы

#### Класс Form

Вместилище всех методов для работы с формами

Класс расширяется от класса Component

Класс является дженериком и принимает в переменной T тип данных

Конструктор принимает такие аргументы:

    1. container: HTMLElement - элемент контейнера, в который будет помещен компонент
    2. events: IEvents - событие, с которым нужно что-то сделать

Класс имеет такие методы:

    1. onInputChange - изменение инпута, вызывающий events.emit с двумя параметрами. 1 - динамическая строка, состоящая из имени контейнера, названия поля. 2 - объект с данными
    2. render - возвращает элемент, представляющий содержимое формы

Сеттеры и геттеры:

    set valid(value: boolean) - проверка валидации кнопки
    set errors(value: string) - отображение текста ошибки

#### Класс Contacts

Реализует работу с mail и phone

Класс расширяется от класса Form

Конструктор принимает такие аргументы:

    1. container: HTMLElement - элемент контейнера, в который будет помещен компонент
    2. events - событие, с которым нужно что-то сделать

Сеттеры и геттеры:

    set phone(value: string) - изменение значения телефона
    set email(value: string) - изменение значения email

#### Класс Modal

Реализует работу с модальными окнами

Класс расширяется от класса Component

Конструктор принимает такие аргументы:

    1. container: HTMLElement - элемент контейнера, в который будет помещен компонент
    2. events: IEvents - событие, с которым нужно что-то сделать

Класс имеет такие методы:

    1. open - открыть модальное окно
    2. close - закрыть модальное окно
    3. render - возвращает элемент, представляющий содержимое компонента

Сеттеры и геттеры:

    set content(value: HTMLElement) - изменение дочерних элементов

#### Класс Order

Реализует работу с заказами

Класс расширяется от класса Form

Конструктор принимает такие аргументы:

    1. container: HTMLElement - элемент контейнера, в который будет помещен компонент
    2. events: IEvents - событие, с которым нужно что-то сделать

Сеттеры и геттеры:

    set address(value: string) - изменение адреса

#### Класс Success

Класс расширяется от класса Component

Конструктор принимает такие аргументы:

    1. container: HTMLElement - элемент контейнера, в который будет помещен компонент
    2. actions: ISuccessActions - действие(например клик)

Сеттеры и геттеры:

    set total(value: string) - отображает потраченную валюту

#### Список всех событий

    - `card:select` - выбор карточки для отображения
    - `items:changed` - отображение каталога карточек
    - `preview:changed` - отображение превью карточки
    - `basket:add` - добавление товара в корзину
    - `formErrorsOrder:change` - событие, сообщающее о необходимости валидации формы адреса
    - `formErrorsContact:change` - событие, сообщающее о необходимости валидации формы контактов
    - `order:submit` - событие перехода на стадию заполнения формы  телефона и mail  пользователя
    - `contacts:submit` - завершение покупки и переход на вывод финального окна
    - `payment:method` - выбор способа оплаты
    - `order:open` - открытие модального окна адреса
    - `basket:removeItem` - удаление товара из корзины
    - `basket:changed` - событие изменения товаров в корзине
    - `basket:open` - открытие модального окна корзины
    - `modal:open` - событие после открытия модального окна(разблокировка скролла экрана)
    - `modal:close` - событие после закрытия модального окна(блокировка скролла экрана)
